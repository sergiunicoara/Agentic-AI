services:
  bench:
    build: .
    command: python -m arena.bench --engines all
    environment:
      # Uncomment/configure as needed:
      # PINECONE_API_KEY: "${PINECONE_API_KEY}"
      # WEAVIATE_URL: "http://weaviate:8080"
      # QDRANT_HOST: "qdrant"
      # MILVUS_HOST: "milvus"
      # ENGINES: "chroma,qdrant,weaviate,milvus,pinecone"
      QDRANT_HOST: "qdrant"
      WEAVIATE_URL: "http://weaviate:8080"
      MILVUS_HOST: "milvus"
      REDIS_HOST: "redis"
      ELASTICSEARCH_URL: "http://elasticsearch:9200"
      OPENSEARCH_URL: "http://opensearch:9200"
      TYPESENSE_URL: "http://typesense:8108"
      TYPESENSE_API_KEY: "xyz"
      PGVECTOR_HOST: "pgvector"
      PGVECTOR_PASSWORD: "postgres"
      VESPA_ENDPOINT: "http://vespa:8080"
      NEO4J_URI: "bolt://neo4j:7687"
      NEO4J_USER: "neo4j"
      NEO4J_PASSWORD: "neo4j_password"
      CLICKHOUSE_HOST: "clickhouse"
      CLICKHOUSE_PORT: "8123"
    depends_on:
      - qdrant
      - weaviate
      - milvus
      - redis
      - elasticsearch
      - opensearch
      - typesense
      - pgvector
      - vespa
      - neo4j
      - clickhouse
    volumes:
      - ./artifacts:/app/artifacts

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"

  weaviate:
    image: semitechnologies/weaviate:latest
    ports:
      - "8080:8080"
      - "50051:50051"	
    environment:
      QUERY_DEFAULTS_LIMIT: "25"
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "true"
      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
      DEFAULT_VECTORIZER_MODULE: "none"
      ENABLE_MODULES: ""
      CLUSTER_HOSTNAME: "node1"

  milvus:
    image: milvusdb/milvus:v2.5.16
    command: ["milvus", "run", "standalone"]
    ports:
      - "19530:19530"
      - "9091:9091"

  # Redis Stack includes RediSearch for vector indexing
  redis:
    image: redis/redis-stack-server:latest
    ports:
      - "6379:6379"
      - "8001:8001"

  # Elasticsearch with security disabled for local benchmarking
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.15.3
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - xpack.security.enrollment.enabled=false
      - ES_JAVA_OPTS=-Xms1g -Xmx1g
    ports:
      - "9200:9200"

  # OpenSearch (includes k-NN plugin). Security plugin disabled for local benchmarking.
  opensearch:
    image: opensearchproject/opensearch:2.13.0
    environment:
      - discovery.type=single-node
      - OPENSEARCH_INITIAL_ADMIN_PASSWORD=StrongPassword123!
      - OPENSEARCH_JAVA_OPTS=-Xms1g -Xmx1g
    ports:
      - "9201:9200"

  # Typesense server
  typesense:
    image: typesense/typesense:0.25.2
    command: ["--data-dir", "/data", "--api-key", "xyz", "--enable-cors"]
    ports:
      - "8108:8108"

  # PostgreSQL + pgvector extension
  pgvector:
    image: pgvector/pgvector:pg16
    environment:
      - POSTGRES_PASSWORD=postgres
    ports:
      - "5433:5432"

  # Vespa - requires an application package to be deployed before use.
  vespa:
    image: vespaengine/vespa:8
    ports:
      - "8080:8080"
    volumes:
      - ./vespa-app:/vespa-app:ro

  # Neo4j with vector index support (Neo4j 5.11+).
  neo4j:
    image: neo4j:5
    environment:
      - NEO4J_AUTH=neo4j/neo4j_password
    ports:
      - "7474:7474"
      - "7687:7687"

  # ClickHouse for vector similarity via distance functions.
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    ports:
      - "8123:8123"
      - "9000:9000"
